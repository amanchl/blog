<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>sumer | articles in the "misc" category</title>
    <link rel="shortcut icon" type="image/png" href="../favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
    <link href="https://amanchl.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="sumer Full Atom Feed" />
    <link href="https://amanchl.github.io/blog/feeds/misc.atom.xml" type="application/atom+xml" rel="alternate" title="sumer Categories Atom Feed" />
    <link rel="stylesheet" href="../theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="../theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Aman Chahal" />
</head>
<body>
    <header>
        <nav>
            <ul>

                <li class="ephemeral selected"><a href="../category/misc.html">misc</a></li>
                <li><a href="../">Home</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="../">sumer</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Feb 22, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="../blog6.html" rel="bookmark" title="Permanent Link to &quot;Scraping and IDG&quot;">Scraping and IDG</a>
                </h2>

                
                

                <h1>Scraping and Preparing Images for Deep Learning Models</h1>
<p>Today, I'll be talking about my Capstone Project at General Assembly, and the tools and processes involved in sourcing the images, as well as importing, preprocessing, and augmenting them before throwing them into my model. So let's begin with the very first part of the project: web scraping.</p>
<h2>Web Scraping</h2>
<p>For this part of the project, I primarily used two tools: Selenium and Gazpacho.</p>
<p><a href="https://pypi.org/project/selenium/">Selenium</a> integrates with WebDrivers such as Firefox and Chrome, and automates certain web browser tasks such as scrolling, clicking on certain buttons, and even logging into websites. Let's recreate the steps for installing, importing, and implementing Selenium.</p>
<div class="highlight"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">selenium</span>
<span class="err">!</span><span class="n">brew</span> <span class="n">install</span> <span class="n">geckodriver</span>
</pre></div>


<p>The above code will download Selenium and Firefox WebDriver on to your machine. Now, let's import Selenium and automate scrolling on a Pinterest page.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.pinterest.ca/carpenter2457/mayan-artifacts/&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">500</span><span class="p">):</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;window.scrollTo(0, document.body.scrollHeight);&quot;</span><span class="p">)</span>
</pre></div>


<p>Next, we'll be installing and importing <a href="https://pypi.org/project/gazpacho/">Gazpacho</a>, which is a web scraping package.</p>
<div class="highlight"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">gazpacho</span>
<span class="kn">from</span> <span class="nn">gazpacho</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">Soup</span>
</pre></div>


<p>It's now time to grab all the HTML from Pinterest, so we can extract all the image URLs.</p>
<div class="highlight"><pre><span></span><span class="n">soup</span> <span class="o">=</span> <span class="n">Soup</span><span class="p">(</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span><span class="p">)</span>
</pre></div>


<p>It's typically quite straightforward to extract elements from HTML code using Gazpacho or Beautiful Soup, but Pinterest has thrown a jumble of nonsense our way, with image links hidden within. Luckily, they all begin with "https" and end with ".jpg" so we are going to make use of some RegEx to extract said links.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">mayan_images</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;https:\/\/[^&quot;]+?\.jpg&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">soup</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">mayan_images</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">686</span>
</pre></div>


<p>Taking a glance at the links, you'll notice that there is a fair amount of repetition in results, which might simply be a Pinterest specific issue. In order to remedy this, we will quickly throw our links into a Pandas DataFrame and extract all the unique links into a list.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">mayan_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mayan_images</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">mayan_urls</span> <span class="o">=</span> <span class="n">mayan_df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">mayan_urls</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">435</span>
</pre></div>


<p>Finally, it's time to download the images from extracted URLs and put them on to our machine. For this purpose, we'll be using a package called <a href="https://pypi.org/project/urllib3/">urllib3</a>. Before actually downloading the images, we will have to create a new folder where the images will be downloaded and stored.</p>
<p>We will only be downloading odd-numbered images from the URL list, as there is again some degree of repetition, wherein the same image gets downloaded in two different sizes. We are only going to download and store the larger ones.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">mayan_urls</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/Users/user/Mayan Artifacts/mayan{mayan_urls.index(url)}.jpg&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>


<p>That's it for web scraping. Let's move on to the next section now.</p>
<h2>ImageDataGenerator</h2>
<p>Once we have our images on our machine, we then have to import them into Python, preprocess them, split the data into training and validation sets, and even augment it in certain cases. For this purpose, the most accessible tool is ImageDataGenerator. Let's import it and see what it can do.</p>
<div class="highlight"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span>
</pre></div>


<p>Before importing our images through IDG, we first have to rescale them so as to reduce the range of input pixels from [0, 255] to [0, 1]. Then we will specify the training set and validation set sizes for the training-validation split. Lastly, will throw in some augmentation arguments such as zoom_rage, vertial_flip, horizontal_flip, brightness, etc. In this instance, we will only be using zoom_rage argument.</p>
<div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">rescale</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                             <span class="n">rotation_range</span> <span class="o">=</span> <span class="mi">75</span><span class="p">,</span>
                             <span class="n">zoom_range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
</pre></div>


<p>Disclaimer: It's always a great idea to put your images inside an appropriately named folder, and then to put that folder inside another parent ("Data") folder. That way, IDG can automatically recognize different folders as separate classes.</p>
<p>We will be importing the training data first, with image size as 128x128, color mode as RBG, class mode as binary, and a batch size of 32.</p>
<div class="highlight"><pre><span></span><span class="n">training</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">flow_from_directory</span><span class="p">(</span><span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;/Users/user/Data&quot;</span><span class="p">,</span>
                                   <span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span>
                                   <span class="n">color_mode</span><span class="o">=</span><span class="s1">&#39;rgb&#39;</span><span class="p">,</span>                                     
                                   <span class="n">class_mode</span> <span class="o">=</span> <span class="s2">&quot;binary&quot;</span><span class="p">,</span>
                                   <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
                                   <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;training&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Found 150 images belonging to 1 classes.</span>
</pre></div>


<p>Let's now repeat the process for the validation data.</p>
<div class="highlight"><pre><span></span><span class="n">validation</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">flow_from_directory</span><span class="p">(</span><span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;/Users/user/Data&quot;</span><span class="p">,</span>
                                   <span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span>
                                   <span class="n">color_mode</span><span class="o">=</span><span class="s1">&#39;rgb&#39;</span><span class="p">,</span>
                                   <span class="n">class_mode</span> <span class="o">=</span> <span class="s2">&quot;binary&quot;</span><span class="p">,</span>
                                   <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
                                   <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Found 64 images belonging to 1 classes.</span>
</pre></div>


<p>We will plot one of the images using matplotlib below, to see if our process worked.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.image</span> <span class="kn">import</span> <span class="n">imread</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">training</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>


<p><img src='https://i.imgur.com/IfLhQZz.png' width="300"></p>
<p>And that's about it. That's how your scrape, import, preprocess, split, and augment image data in Python. Hope this post was informative!</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="../blog6.html">posted at 11:00</a>
                </div>
            </article>            <h4 class="date">Feb 02, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="../blog5.html" rel="bookmark" title="Permanent Link to &quot;Huey&quot;">Huey</a>
                </h2>

                
                

                <p>Today, I'll be covering a lightweight task queue package for Python called Huey. It's a neat little package for task execution at a given time or a specified delay. It's also quite handy for scheduling recurring tasks, automatically retrying failed tasks, as well as a host of other nifty features.</p>
<p>For this particular post, I'll be grabbing Apple stock prices in real time, and using Huey to update my data in real time. For this purpose, I will be using the Yahoo Finance API.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
</pre></div>


<p>I'll now import the requisite packages and instantiate Huey. For this example, I will be using the Immediate Mode instead of a local Redis server or SQLite, but I will be updating this post later on and cover those features as well. In immediate mode, Huey will execute task functions immediately rather than queueing them, but it will preserve the behaviors  of a dedicated consumer process (not covered today).</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">huey</span> <span class="kn">import</span> <span class="n">RedisHuey</span><span class="p">,</span> <span class="n">crontab</span>
<span class="kn">from</span> <span class="nn">huey</span> <span class="kn">import</span> <span class="n">crontab</span>

<span class="n">huey</span> <span class="o">=</span> <span class="n">RedisHuey</span><span class="p">(</span><span class="s1">&#39;my-app&#39;</span><span class="p">,</span> <span class="n">immediate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>


<p>Here, I will grab some Apple stocks data for the last 7 days on a refresh interval of 1 minute, and put it into a Pandas DataFrame, which I will iterate over with new data using Huey.</p>
<div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">tickers</span><span class="o">=</span> <span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
<span class="n">period</span><span class="o">=</span><span class="s2">&quot;7d&quot;</span><span class="p">,</span>
<span class="n">interval</span><span class="o">=</span><span class="s2">&quot;1m&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">[*********************100%***********************]  1 of 1 completed</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
    <tr>
      <th>Datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-31 15:55:00-05:00</th>
      <td>309.940002</td>
      <td>310.049988</td>
      <td>309.640015</td>
      <td>309.649994</td>
      <td>309.649994</td>
      <td>240384</td>
    </tr>
    <tr>
      <th>2020-01-31 15:56:00-05:00</th>
      <td>309.640015</td>
      <td>309.670013</td>
      <td>309.170013</td>
      <td>309.429993</td>
      <td>309.429993</td>
      <td>327785</td>
    </tr>
    <tr>
      <th>2020-01-31 15:57:00-05:00</th>
      <td>309.429993</td>
      <td>309.799988</td>
      <td>309.369995</td>
      <td>309.779999</td>
      <td>309.779999</td>
      <td>248953</td>
    </tr>
    <tr>
      <th>2020-01-31 15:58:00-05:00</th>
      <td>309.779999</td>
      <td>309.809998</td>
      <td>309.559998</td>
      <td>309.649994</td>
      <td>309.649994</td>
      <td>314132</td>
    </tr>
    <tr>
      <th>2020-01-31 15:59:00-05:00</th>
      <td>309.640015</td>
      <td>309.690002</td>
      <td>309.130005</td>
      <td>309.390015</td>
      <td>309.390015</td>
      <td>578890</td>
    </tr>
  </tbody>
</table>
</div>

<p>Below is a function that grabs Apple stock data from Yahoo Finance and concatenates it on top of the existing data.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">stocks</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="n">newdata</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">tickers</span><span class="o">=</span> <span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
    <span class="n">period</span><span class="o">=</span><span class="s2">&quot;1m&quot;</span><span class="p">,</span>
    <span class="n">interval</span><span class="o">=</span><span class="s2">&quot;1m&quot;</span><span class="p">)</span>
    <span class="n">final</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">,</span><span class="n">newdata</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">final</span>
</pre></div>


<p>This Huey periodic task function carries out the function above each minute between 9AM and 4PM Monday through Friday. The time intervals can be changed depending on the use case.</p>
<div class="highlight"><pre><span></span><span class="nd">@huey</span><span class="o">.</span><span class="n">periodic_task</span><span class="p">(</span><span class="n">crontab</span><span class="p">(</span><span class="n">minute</span><span class="o">=</span><span class="s1">&#39;*/1&#39;</span><span class="p">,</span><span class="n">hour</span><span class="o">=</span><span class="s1">&#39;9-16&#39;</span><span class="p">,</span><span class="n">day_of_week</span><span class="o">=</span><span class="s1">&#39;1-5&#39;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">update_stocks</span><span class="p">():</span>
    <span class="n">stocks</span><span class="p">()</span>
</pre></div>


<p>The task has been executed below. Once a local server has been integrated into this process, the task will recur each minute and update our stock data in real time.</p>
<div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">update_stocks</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">[*********************100%***********************]  1 of 1 completed</span>
</pre></div>
                <div class="clear"></div>

                <div class="info">
                    <a href="../blog5.html">posted at 07:40</a>
                </div>
            </article>            <h4 class="date">Jan 25, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="../blog4.html" rel="bookmark" title="Permanent Link to &quot;Natural Poem Processing&quot;">Natural Poem Processing</a>
                </h2>

                
                

                <h1>Natural Poem Processing</h1>
<p>In this post, I will be scraping the works of three famous poets--William Wordsworth, John Milton, and Thomas Hardy--and running them through a natural language processing algorithm with the goal of identifying the author by feeding a poem into said algorithm.</p>
<p>Let's begin by importing the requisite packages.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gazpacho</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">Soup</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">nltk.stem.porter</span> <span class="kn">import</span> <span class="n">PorterStemmer</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">RegexpTokenizer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn_pandas</span> <span class="kn">import</span> <span class="n">DataFrameMapper</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;stopwords&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">[</span><span class="n">nltk_data</span><span class="o">]</span><span class="w"> </span><span class="n">Downloading</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="n">stopwords</span><span class="w"> </span><span class="k">to</span><span class="w"></span>
<span class="o">[</span><span class="n">nltk_data</span><span class="o">]</span><span class="w">     </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">sunnychahal</span><span class="o">/</span><span class="n">nltk_data</span><span class="p">...</span><span class="w"></span>
<span class="o">[</span><span class="n">nltk_data</span><span class="o">]</span><span class="w">   </span><span class="n">Package</span><span class="w"> </span><span class="n">stopwords</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">up</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="nc">date</span><span class="err">!</span><span class="w"></span>
</pre></div>


<p>I will be sourcing my corpus data from the Poetry Foundation website using Gazpacho--a web scraping library developed by <a href="https://github.com/maxhumber">Max Humber</a>. The scraping process is fairly simple, as there aren't many inconsistencies in the HTML code. I'll be scraping the individual poem URL for each poem on each poet's page, and adding it to a URL list. This list will then be fed into a custom scraping function in order to scrape a list of poems from each author.</p>
<div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.poetryfoundation.org/poets/william-wordsworth&#39;</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">Soup</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="n">poems</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s2">&quot;o-graphBlocks o-graphBlocks_matrix o-graphBlocks_3up@small o-graphBlocks_4up@medium o-graphBlocks_matrix_obscuredAfter12&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)</span>
<span class="n">url_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">poem</span> <span class="ow">in</span> <span class="n">poems</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>


<p>Below is a list of all the scraped URLs for William Wordsworth.</p>
<div class="highlight"><pre><span></span><span class="n">url_list</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">[&#39;https://www.poetryfoundation.org/poems/45512/character-of-the-happy-warrior&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45513/a-complaint&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45514/composed-upon-westminster-bridge-september-3-1802&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45516/elegiac-stanzas-suggested-by-a-picture-of-peele-castle-in-a-storm-painted-by-sir-george-beaumont&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45517/extempore-effusion-upon-the-death-of-james-hogg&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45518/the-french-revolution-as-it-appeared-to-enthusiasts-at-its-commencement&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45519/the-green-linnet&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45520/i-travelled-among-unknown-men&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45521/i-wandered-lonely-as-a-cloud&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45522/influence-of-natural-objects-in-calling-forth-and-strengthening-the-imagination-in-boyhood-and-early-youth&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45523/inside-of-kings-college-chapel-cambridge&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45524/it-is-a-beauteous-evening-calm-and-free&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45525/it-is-not-to-be-thought-of&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45526/laodamia&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45527/lines-composed-a-few-miles-above-tintern-abbey-on-revisiting-the-banks-of-the-wye-during-a-tour-july-13-1798&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/51001/lines-written-in-early-spring&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45528/london-1802&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45530/most-sweet-it-is&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45531/mutability&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45532/november-1806&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/52299/nuns-fret-not-at-their-convents-narrow-room&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45533/nutting&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45534/october-1803&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45536/ode-intimations-of-immortality-from-recollections-of-early-childhood&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45535/ode-to-duty&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45538/on-the-departure-of-sir-walter-scott-from-abbotsford-for-naples&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45539/on-the-extinction-of-the-venetian-republic&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45541/a-poet-he-hath-put-his-heart-to-school&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45540/the-power-of-armies-is-a-visible-thing&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45542/the-prelude-book-1-childhood-and-school-time&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45543/the-prelude-book-2-school-time-continued&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45545/resolution-and-independence&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45546/the-reverie-of-poor-susan&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45547/scorn-not-the-sonnet&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45548/september-1819&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45549/she-dwelt-among-the-untrodden-ways&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45550/she-was-a-phantom-of-delight&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45551/simon-lee-the-old-huntsman&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45552/the-simplon-pass&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45553/a-slumber-did-my-spirit-seal&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45554/the-solitary-reaper&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45555/song-at-the-feast-of-brougham-castle-upon-the-restoration-of-lord-clifford-the-shepherd-to-the-estates-and-honours-of-his-ancestors&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45556/sonnets-from-the-river-duddon-after-thought&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/50285/surprised-by-joy&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45557/the-tables-turned&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45558/there-was-a-boy&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/52996/the-thorn-56d231ea9f8d9&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45559/three-years-she-grew&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45560/to-a-highland-girl&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45561/to-a-skylark-56d225364d1a9&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45562/to-the-cuckoo&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45563/the-virgin&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/52298/we-are-seven&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/50397/why-art-thou-silent-is-thy-love-a-plant&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45564/the-world-is-too-much-with-us&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45565/written-in-london-september-1802&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45566/yarrow-revisited&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45568/yarrow-unvisited&#39;,</span>
<span class="err"> &#39;https://www.poetryfoundation.org/poems/45567/yarrow-visited-september-1814&#39;]</span>
</pre></div>


<p>At this stage, I will define a scrape_poem function to use the previously extracted list of URLs and source the poem text from each poem's page for Wordsworth. In order to remove all the unnecessary code, I'll add the remove_tags() method to derive the final poem text.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scrape_poem</span><span class="p">(</span><span class="n">poemurl</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">poemurl</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">Soup</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;o-poem &#39;</span><span class="p">})</span><span class="o">.</span><span class="n">remove_tags</span><span class="p">()</span>
</pre></div>


<p>Next, I'll run a for loop and use the previously defined function to create a new list with all of Wordsworth's poems.</p>
<div class="highlight"><pre><span></span><span class="n">wordsworth_poems_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">url_list</span><span class="p">:</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">wordsworth_poems_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scrape_poem</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</pre></div>


<p>The extracted poems have some textual inconsistencies and errors, so those will be handled with a simple regex fuction, which acts much like the regular replace method.</p>
<div class="highlight"><pre><span></span><span class="n">wordsworth_poems</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">poem</span> <span class="ow">in</span> <span class="n">wordsworth_poems_list</span><span class="p">:</span>
    <span class="n">poem</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([A-Z])&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot; \1&quot;</span><span class="p">,</span> <span class="n">poem</span><span class="p">)</span>
    <span class="n">wordsworth_poems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poem</span><span class="p">)</span>
</pre></div>


<p>Finally, the cleaned list of poems will be fitted into a Pandas dataframe with two columns--poems and author.</p>
<div class="highlight"><pre><span></span><span class="n">wordsworth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">wordsworth_poems</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;poems&#39;</span><span class="p">])</span>
<span class="n">wordsworth</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Wordsworth&#39;</span>
<span class="n">wordsworth</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>poems</th>
      <th>author</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Who is the happy  Warrior?  Who is he That ev...</td>
      <td>Wordsworth</td>
    </tr>
    <tr>
      <th>1</th>
      <td>There is a change—and  I am poor;  Your love ...</td>
      <td>Wordsworth</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Earth has not any thing to show more fair:  D...</td>
      <td>Wordsworth</td>
    </tr>
    <tr>
      <th>3</th>
      <td>I was thy neighbour once, thou rugged  Pile! ...</td>
      <td>Wordsworth</td>
    </tr>
    <tr>
      <th>4</th>
      <td>When first, descending from the moorlands,  I...</td>
      <td>Wordsworth</td>
    </tr>
  </tbody>
</table>
</div>

<p>The entire process will now be repeated for John Milton and Thomas Hardy.</p>
<div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.poetryfoundation.org/poets/john-milton&#39;</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">Soup</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="n">poems</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s2">&quot;o-graphBlocks o-graphBlocks_matrix o-graphBlocks_3up@small o-graphBlocks_4up@medium o-graphBlocks_matrix_obscuredAfter12&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)</span>
<span class="n">url_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">poem</span> <span class="ow">in</span> <span class="n">poems</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">milton_poems_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">url_list</span><span class="p">:</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">milton_poems_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scrape_poem</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">milton_poems</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">poem</span> <span class="ow">in</span> <span class="n">milton_poems_list</span><span class="p">:</span>
    <span class="n">poem</span> <span class="o">=</span> <span class="n">poem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">milton_poems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poem</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">milton</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">milton_poems</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;poems&#39;</span><span class="p">])</span>
<span class="n">milton</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Milton&#39;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">milton</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>poems</th>
      <th>author</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Blest pair of Sirens, pledges of Heav'ns joy, ...</td>
      <td>Milton</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Hail native language, that by sinews weak Dids...</td>
      <td>Milton</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Hence vain deluding Joys, The brood of Folly w...</td>
      <td>Milton</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Hence loathed Melancholy, Of Cerberus, and bla...</td>
      <td>Milton</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Yet once more, O ye laurels, and once more Ye ...</td>
      <td>Milton</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.poetryfoundation.org/poets/thomas-hardy&#39;</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">Soup</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="n">poems</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s2">&quot;o-graphBlocks o-graphBlocks_matrix o-graphBlocks_3up@small o-graphBlocks_4up@medium o-graphBlocks_matrix_obscuredAfter12&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)</span>
<span class="n">url_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">poem</span> <span class="ow">in</span> <span class="n">poems</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">hardy_poems_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">url_list</span><span class="p">:</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">hardy_poems_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scrape_poem</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">hardy_poems</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">poem</span> <span class="ow">in</span> <span class="n">hardy_poems_list</span><span class="p">:</span>
    <span class="n">poem</span> <span class="o">=</span> <span class="n">poem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">poem</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([A-Z])&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot; \1&quot;</span><span class="p">,</span> <span class="n">poem</span><span class="p">)</span>
    <span class="n">hardy_poems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poem</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">hardy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">hardy_poems</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;poems&#39;</span><span class="p">])</span>
<span class="n">hardy</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Hardy&#39;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">hardy</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>poems</th>
      <th>author</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>I  When moiling seems at cease  In the vague ...</td>
      <td>Hardy</td>
    </tr>
    <tr>
      <th>1</th>
      <td>( On the  Signing of the  Armistice, 11  Nov. ...</td>
      <td>Hardy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Had  I but lived a hundred years ago  I might...</td>
      <td>Hardy</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(in  Memoriam  F.  W.  G.)  Orion swung southw...</td>
      <td>Hardy</td>
    </tr>
    <tr>
      <th>4</th>
      <td>You did not come,  And marching  Time drew on...</td>
      <td>Hardy</td>
    </tr>
  </tbody>
</table>
</div>

<p>The three dataframes will now be combined into one using the concatenate function in Pandas.</p>
<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">milton</span><span class="p">,</span><span class="n">wordsworth</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">final</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">hardy</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">final</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>poems</th>
      <th>author</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Blest pair of Sirens, pledges of Heav'ns joy, ...</td>
      <td>Milton</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Hail native language, that by sinews weak Dids...</td>
      <td>Milton</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Hence vain deluding Joys, The brood of Folly w...</td>
      <td>Milton</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Hence loathed Melancholy, Of Cerberus, and bla...</td>
      <td>Milton</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Yet once more, O ye laurels, and once more Ye ...</td>
      <td>Milton</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">final</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;poemsfinal.csv&quot;</span><span class="p">)</span>
</pre></div>


<p>It's now time to prepare the dataframe mapper and classification model for our pipeline. I begin by defining my X and y values, as well as performing a test train split with a test size of 40% and a random state of FiveThirtyEight.</p>
<div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">final</span><span class="p">[[</span><span class="s1">&#39;poems&#39;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">final</span><span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.40</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">538</span><span class="p">)</span>
</pre></div>


<p>Below is a custom fuction that will take in each poem as an input, and perform serveral operations on top of it. This process with convert all text to lower case, tokenize the words in each poem, remove the stopwords, stem the remaining words, and eventually put the words back together into a string.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">poem_to_tokens</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
    <span class="n">lower_case</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">retokenizer</span> <span class="o">=</span> <span class="n">RegexpTokenizer</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+&#39;</span><span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">retokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">lower_case</span><span class="p">)</span>
    <span class="n">stops</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">))</span>
    <span class="n">meaningful_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">stops</span><span class="p">]</span>
    <span class="n">stemmer</span> <span class="o">=</span> <span class="n">PorterStemmer</span><span class="p">()</span>
    <span class="n">stemmed_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">meaningful_words</span><span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stemmed_words</span><span class="p">)</span>
</pre></div>


<p>I'll be using Logistic Regression for this classification task.</p>
<div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
</pre></div>


<p>The mapper will perform the previously defined poem_to_tokens function on top of each poem in the dataframe, and then the CountVectorizer in addition.</p>
<div class="highlight"><pre><span></span><span class="n">mapper</span> <span class="o">=</span> <span class="n">DataFrameMapper</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;poems&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">poem_to_tokens</span><span class="p">),</span> <span class="n">CountVectorizer</span><span class="p">()])</span>
<span class="p">],</span> <span class="n">df_out</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>


<p>I will now feed the model and mapper I have defined into a pipeline, and then fit and score my model. This will tell me exactly how accurate my classification model is.</p>
<div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">sunnychahal</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">linear_model</span><span class="o">/</span><span class="n">logistic</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">433</span><span class="p">:</span> <span class="n">FutureWarning</span><span class="p">:</span> <span class="k">Default</span> <span class="n">solver</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changed</span> <span class="k">to</span> <span class="s1">&#39;lbfgs&#39;</span> <span class="k">in</span> <span class="mi">0</span><span class="p">.</span><span class="mi">22</span><span class="p">.</span> <span class="n">Specify</span> <span class="n">a</span> <span class="n">solver</span> <span class="k">to</span> <span class="n">silence</span> <span class="n">this</span> <span class="n">warning</span><span class="p">.</span>
  <span class="n">FutureWarning</span><span class="p">)</span>
<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">sunnychahal</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">linear_model</span><span class="o">/</span><span class="n">logistic</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">460</span><span class="p">:</span> <span class="n">FutureWarning</span><span class="p">:</span> <span class="k">Default</span> <span class="n">multi_class</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changed</span> <span class="k">to</span> <span class="s1">&#39;auto&#39;</span> <span class="k">in</span> <span class="mi">0</span><span class="p">.</span><span class="mi">22</span><span class="p">.</span> <span class="n">Specify</span> <span class="n">the</span> <span class="n">multi_class</span> <span class="k">option</span> <span class="k">to</span> <span class="n">silence</span> <span class="n">this</span> <span class="n">warning</span><span class="p">.</span>
  <span class="ss">&quot;this warning.&quot;</span><span class="p">,</span> <span class="n">FutureWarning</span><span class="p">)</span>





<span class="n">Pipeline</span><span class="p">(</span><span class="n">memory</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
     <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;dataframemapper&#39;</span><span class="p">,</span> <span class="n">DataFrameMapper</span><span class="p">(</span><span class="k">default</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">df_out</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
        <span class="n">features</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;poems&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="k">None</span><span class="p">),</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">analyzer</span><span class="o">=</span><span class="s1">&#39;word&#39;</span><span class="p">,</span> <span class="nb">binary</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">decode_error</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=&lt;</span><span class="k">class</span> <span class="s1">&#39;numpy.int64&#39;</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="k">input</span><span class="o">=</span><span class="s1">&#39;content&#39;</span><span class="p">,</span>
        <span class="n">lowercase</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">ma</span><span class="p">...</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span>
          <span class="n">tol</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">0001</span><span class="p">,</span> <span class="k">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="k">False</span><span class="p">))])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">1.0</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">0.8113207547169812</span>
</pre></div>


<p>It appears the accuracy score is quite respectable. Not quite where I'd like it to be, but not terrible for a first attempt. Finally, I will create a new dataframe with just one entry to predict the author of the poem that's being fed into the model.</p>
<p>I will be using Song on May Morning by John Milton.</p>
<div class="highlight"><pre><span></span><span class="n">new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;poems&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;NOW the bright morning-star, Day’s harbinger, Comes dancing from the East, and leads with her The flowery May, who from her green lap throws The yellow cowslip and the pale primrose. Hail, bounteous May, that dost inspire Mirth, and youth, and warm desire! Woods and groves are of thy dressing; Hill and dale doth boast thy blessing. Thus we salute thee with our early song, And welcome thee, and wish thee long.&quot;</span><span class="p">]})</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">array([&#39;Milton&#39;], dtype=object)</span>
</pre></div>


<p>Not too shabby, but the model could certainly use more complexity and nuance. So that was a basic NLP classification model that accepts a poem, and hopefully returns the name of its author.</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="../blog4.html">posted at 13:10</a>
                </div>
            </article>            <h4 class="date">Jan 04, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="../blog3.html" rel="bookmark" title="Permanent Link to &quot;Renewable Energy and Ugly Data&quot;">Renewable Energy and Ugly Data</a>
                </h2>

                
                

                <h1>Renewable Energy and Ugly Data</h1>
<p>In this post, we'll be borrowing a somewhat unflattering stacked bar chart from <a href="https://www.bloomberg.com/opinion/articles/2019-10-23/coal-is-in-retreat-worldwide-as-renewable-energy-costs-drop">this</a> particular Bloomberg article on the decline of coal power in the developed world as well as developing. We will be using Altair for this visualization exercise.</p>
<p><img alt="" src="https://i.imgur.com/6lWl5SU.png"></p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">sea</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;renewables.csv&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">sea</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Cambodia</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.1</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Indonesia</td>
      <td>0.7</td>
      <td>6.2</td>
      <td>6.1</td>
      <td>1.1</td>
      <td>1.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Malaysia</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Phillippines</td>
      <td>0.8</td>
      <td>1.0</td>
      <td>0.1</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Thailand</td>
      <td>0.0</td>
      <td>0.6</td>
      <td>0.1</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>In order to prepare the dataframe for a stacked bar chart, it is first necessary to melt the year columns all into one.</p>
<div class="highlight"><pre><span></span><span class="n">sea</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">sea</span><span class="p">,</span> <span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Country&quot;</span><span class="p">],</span> <span class="n">value_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;2015&quot;</span><span class="p">,</span> <span class="s2">&quot;2016&quot;</span><span class="p">,</span> <span class="s2">&quot;2017&quot;</span><span class="p">,</span> <span class="s2">&quot;2018&quot;</span><span class="p">,</span> <span class="s2">&quot;2019&quot;</span><span class="p">],</span> <span class="n">var_name</span> <span class="o">=</span> <span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;Capacity&#39;</span><span class="p">,)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">sea</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Year</th>
      <th>Capacity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Cambodia</td>
      <td>2015</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Indonesia</td>
      <td>2015</td>
      <td>0.7</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Malaysia</td>
      <td>2015</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Phillippines</td>
      <td>2015</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Thailand</td>
      <td>2015</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Below, we will spin up a stacked bar chart in Altair depicting the construction of new coal power generators in the South East Asian countries of Cambodia, Indonesia, Malaysia, Phillippines, Thailand, and Vietnam by year between 2015 and the first half of 2019.</p>
<p>To make things neater, it's probably a good idea to remove the grid as well as unnecessary broders around the chart. Aditionally, the choice of colors for each country in the original chart is both confusing and unattractive, so we will change that up a little.</p>
<p>Next, we're going to rescale the X-axis to the range of 0-15 so as to accurately depict the data, as well as simplify the X ticks in order to further reduce the clutter.</p>
<p>The legend seems a tad small in comparison to the chart so that's going to need some tweaking as well.</p>
<p>Finally, using tooltip, we'll add an interactive element to the chart wherein, simply by hovering your mouse pointer over an area of any bar, you will be able to see the corresponding country and its projected additional coal power generation capacity for that year.</p>
<div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">sea</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;New Coal Generator (in Megawatts) Construction in South East Asia By Year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">title</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">labelAngle</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;Capacity&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">title</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">]),</span><span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">])),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="n">orient</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">)),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="s2">&quot;Capacity&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">configure_axis</span><span class="p">(</span>
    <span class="n">grid</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span><span class="o">.</span><span class="n">configure_view</span><span class="p">(</span><span class="n">strokeOpacity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">configure_legend</span><span class="p">(</span><span class="n">clipHeight</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">labelFontSize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">titleFontSize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>


<div id="altair-viz-22"></div>

<script type="text/javascript">
  (function(spec, embedOpt){
    const outputDiv = document.getElementById("altair-viz-22");
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.0.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300, "strokeOpacity": 0}, "axis": {"grid": false}, "legend": {"clipHeight": 25, "labelFontSize": 15, "titleFontSize": 15}}, "data": {"name": "data-756e8efff7e925bd041eca43b6e8db24"}, "mark": "bar", "encoding": {"color": {"type": "nominal", "field": "Country", "legend": {"orient": "right", "title": "Country"}}, "tooltip": [{"type": "nominal", "field": "Country"}, {"type": "quantitative", "field": "Capacity"}], "x": {"type": "nominal", "axis": {"labelAngle": 0, "title": null}, "field": "Year"}, "y": {"type": "quantitative", "axis": {"title": null, "values": [0, 5, 10, 15]}, "field": "Capacity", "scale": {"domain": [0, 15]}}}, "height": 500, "title": "New Coal Generator (in Megawatts) Construction in South East Asia By Year", "width": 800, "$schema": "https://vega.github.io/schema/vega-lite/v4.0.0.json", "datasets": {"data-756e8efff7e925bd041eca43b6e8db24": [{"Country": "Cambodia", "Year": "2015", "Capacity": 0.0}, {"Country": "Indonesia", "Year": "2015", "Capacity": 0.7}, {"Country": "Malaysia", "Year": "2015", "Capacity": 0.0}, {"Country": "Phillippines", "Year": "2015", "Capacity": 0.8}, {"Country": "Thailand", "Year": "2015", "Capacity": 0.0}, {"Country": "Vietnam", "Year": "2015", "Capacity": 3.6}, {"Country": "Cambodia", "Year": "2016", "Capacity": 0.0}, {"Country": "Indonesia", "Year": "2016", "Capacity": 6.2}, {"Country": "Malaysia", "Year": "2016", "Capacity": 2.0}, {"Country": "Phillippines", "Year": "2016", "Capacity": 1.0}, {"Country": "Thailand", "Year": "2016", "Capacity": 0.6}, {"Country": "Vietnam", "Year": "2016", "Capacity": 3.1}, {"Country": "Cambodia", "Year": "2017", "Capacity": 0.0}, {"Country": "Indonesia", "Year": "2017", "Capacity": 6.1}, {"Country": "Malaysia", "Year": "2017", "Capacity": 0.0}, {"Country": "Phillippines", "Year": "2017", "Capacity": 0.1}, {"Country": "Thailand", "Year": "2017", "Capacity": 0.1}, {"Country": "Vietnam", "Year": "2017", "Capacity": 0.0}, {"Country": "Cambodia", "Year": "2018", "Capacity": 0.1}, {"Country": "Indonesia", "Year": "2018", "Capacity": 1.1}, {"Country": "Malaysia", "Year": "2018", "Capacity": 0.0}, {"Country": "Phillippines", "Year": "2018", "Capacity": 0.0}, {"Country": "Thailand", "Year": "2018", "Capacity": 0.0}, {"Country": "Vietnam", "Year": "2018", "Capacity": 1.5}, {"Country": "Cambodia", "Year": "2019", "Capacity": 0.0}, {"Country": "Indonesia", "Year": "2019", "Capacity": 1.5}, {"Country": "Malaysia", "Year": "2019", "Capacity": 0.0}, {"Country": "Phillippines", "Year": "2019", "Capacity": 0.0}, {"Country": "Thailand", "Year": "2019", "Capacity": 0.0}, {"Country": "Vietnam", "Year": "2019", "Capacity": 0.0}]}}, {"mode": "vega-lite"});
</script>
                <div class="clear"></div>

                <div class="info">
                    <a href="../blog3.html">posted at 11:10</a>
                </div>
            </article>            <h4 class="date">Sep 12, 2019</h4>

            <article class="post">
                <h2 class="title">
                    <a href="../blog2.html" rel="bookmark" title="Permanent Link to &quot;Seaborn&quot;">Seaborn</a>
                </h2>

                
                

                <h1>Titanic Status: Seaborn</h1>
<p>Data visualization is a keystone of data science, and can serve as a powerful tool to communicate findings and insights in a digestible manner to the layperson. It can also help data scientists to uncover hidden and less obvious patterns and insight through exploratory analysis.</p>
<p>While the Matplotlib library is the popular choice for presentation, in large part due to its customizability, Seaborn is perhaps a more suitable tool for quick exploratory analysis owing to its quick and nimble nature. Simple plots can be drawn up with one mere line of code, which frees up time and effort to divert cognitive resources to more pressing matters.</p>
<p>Let's explore one of the most popular datasets--Titanic--to explore the capabilities of Seaborn.
We begin by importing all the requisite libraries to import and parse the dataset, as well as draw up a handful of seaborn plots.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">titanic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;train.csv&quot;</span><span class="p">)</span>
</pre></div>


<p>Let's take a quick look at the columns and the first ten rows of the dataset.</p>
<div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PassengerId</th>
      <th>Survived</th>
      <th>Pclass</th>
      <th>Name</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Ticket</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>Braund, Mr. Owen Harris</td>
      <td>male</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>A/5 21171</td>
      <td>7.2500</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>Cumings, Mrs. John Bradley (Florence Briggs Th...</td>
      <td>female</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>PC 17599</td>
      <td>71.2833</td>
      <td>C85</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>3</td>
      <td>Heikkinen, Miss. Laina</td>
      <td>female</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>STON/O2. 3101282</td>
      <td>7.9250</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
      <td>female</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>113803</td>
      <td>53.1000</td>
      <td>C123</td>
      <td>S</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>0</td>
      <td>3</td>
      <td>Allen, Mr. William Henry</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>373450</td>
      <td>8.0500</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>0</td>
      <td>3</td>
      <td>Moran, Mr. James</td>
      <td>male</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>330877</td>
      <td>8.4583</td>
      <td>NaN</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>0</td>
      <td>1</td>
      <td>McCarthy, Mr. Timothy J</td>
      <td>male</td>
      <td>54.0</td>
      <td>0</td>
      <td>0</td>
      <td>17463</td>
      <td>51.8625</td>
      <td>E46</td>
      <td>S</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>0</td>
      <td>3</td>
      <td>Palsson, Master. Gosta Leonard</td>
      <td>male</td>
      <td>2.0</td>
      <td>3</td>
      <td>1</td>
      <td>349909</td>
      <td>21.0750</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>1</td>
      <td>3</td>
      <td>Johnson, Mrs. Oscar W (Elisabeth Vilhelmina Berg)</td>
      <td>female</td>
      <td>27.0</td>
      <td>0</td>
      <td>2</td>
      <td>347742</td>
      <td>11.1333</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>1</td>
      <td>2</td>
      <td>Nasser, Mrs. Nicholas (Adele Achem)</td>
      <td>female</td>
      <td>14.0</td>
      <td>1</td>
      <td>0</td>
      <td>237736</td>
      <td>30.0708</td>
      <td>NaN</td>
      <td>C</td>
    </tr>
  </tbody>
</table>
</div>

<p>A simple pairplot would deliver plotwise relationships between relevant columns in the dataset for a quick initial look.</p>
<div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">titanic</span><span class="p">);</span>
</pre></div>


<p><img alt="" src="https://i.imgur.com/EUdU9tW.png"></p>
<p>Now, we will draw up a heatmap to better undsersand the intensity of correlation between the various variables. We will set annotations to True in order to better understand these correlations.</p>
<div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">titanic</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">);</span>
</pre></div>


<p><img alt="" src="https://i.imgur.com/DEBzXfX.png"></p>
<p>There seems to be a faintly positive relationship between the ticket fare and survival rates.</p>
<p>Next, we will explore the age distribution using the distplot. In order to do that, we'll first drop all the values in the age column with NaN values.</p>
<div class="highlight"><pre><span></span><span class="n">titanic</span> <span class="o">=</span> <span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">8</span><span class="p">);</span>
</pre></div>


<p><img alt="" src="https://i.imgur.com/WJcIjLc.png"></p>
<p>It appears the majority of passengers were between 20 and 30 years of age, with the number of passengers in subsequent age brackets dropping progressively.  </p>
<p>Let us now explore the ticket fare range for each passenger class using a boxplot. To make things easier to interpret, we will also increase the size of the figure.</p>
<div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Pclass&quot;</span><span class="p">],</span> <span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Fare&quot;</span><span class="p">]);</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:(</span><span class="mi">17</span><span class="p">,</span><span class="mi">8</span><span class="p">)})</span>
</pre></div>


<p><img alt="" src="https://i.imgur.com/eD0jIPf.png"></p>
<p>Passenger class 1, to no one's surprise, has the highest and widest range of prices. A peculiar addition to that obvious finding would be a ticket that appears to have cost over $500. Let's see if we can find out someone who belongs to the early 20th century 1% club.</p>
<div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">][</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Fare&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">258                      Ward, Miss. Anna</span>
<span class="err">679    Cardeza, Mr. Thomas Drake Martinez</span>
<span class="err">737                Lesurer, Mr. Gustave J</span>
<span class="c">Name: Name, dtype: object</span>
</pre></div>


<p>As it turns out, it's not just one, but three people who hold the priciest ticket of the ship. I wonder if they made it.</p>
<div class="highlight"><pre><span></span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Survived&quot;</span><span class="p">][</span><span class="n">titanic</span><span class="p">[</span><span class="s2">&quot;Fare&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">258    1</span>
<span class="err">679    1</span>
<span class="err">737    1</span>
<span class="c">Name: Survived, dtype: int64</span>
</pre></div>


<p>Of course they did. $500 tickets come with their own perks.</p>
<p>We can do some further exploratory analysis with a factorplot to extract the average age of men and women who survived and thsoe who did not.</p>
<div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">factorplot</span><span class="p">(</span><span class="s2">&quot;Survived&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="s2">&quot;Sex&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">titanic</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">);</span>
</pre></div>


<p><img alt="" src="https://i.imgur.com/GzhaWBy.png"></p>
<p>For those that did not make it, men tended to be, on average, older than the women. For those that survived, men, on average, were younger.</p>
<p>These are just some of the countless ways seaborn can be used to conjure up exploratory visuals with minimal code. While this might not be the most suitable solution for more complex visualizations for presentation purposes, it's a nifty little tool to get started on some data-oriented detective work with such little effort.</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="../blog2.html">posted at 11:35</a>
                </div>
            </article>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="../feeds/all.atom.xml" rel="alternate">Atom Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>