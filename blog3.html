<!DOCTYPE html>
<html lang="en">
<head>
 <title>Renewable Energy and Ugly Data</title>
 <!-- Latest compiled and minified CSS -->
 <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
 <div class="container">
  <h1><a href=".">sumer</a></h1>
 </div>
</head>
<body>
 <div class="container">
<div class="row">
 <div class="col-md-8">
  <h3>Renewable Energy and Ugly Data</h3>
  <label>2020-01-04</label>
  <h1>Renewable Energy and Ugly Data</h1>
<p>In this post, we'll be borrowing a somewhat unflattering stacked bar chart from <a href="https://www.bloomberg.com/opinion/articles/2019-10-23/coal-is-in-retreat-worldwide-as-renewable-energy-costs-drop">this</a> particular Bloomberg article on the decline of coal power in the developed world as well as developing. We will be using Altair for this visualization exercise.</p>
<p><img alt="" src="https://i.imgur.com/6lWl5SU.png"></p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">sea</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;renewables.csv&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">sea</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Cambodia</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.1</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Indonesia</td>
      <td>0.7</td>
      <td>6.2</td>
      <td>6.1</td>
      <td>1.1</td>
      <td>1.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Malaysia</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Phillippines</td>
      <td>0.8</td>
      <td>1.0</td>
      <td>0.1</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Thailand</td>
      <td>0.0</td>
      <td>0.6</td>
      <td>0.1</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>In order to prepare the dataframe for a stacked bar chart, it is first necessary to melt the year columns all into one.</p>
<div class="highlight"><pre><span></span><span class="n">sea</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">sea</span><span class="p">,</span> <span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Country&quot;</span><span class="p">],</span> <span class="n">value_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;2015&quot;</span><span class="p">,</span> <span class="s2">&quot;2016&quot;</span><span class="p">,</span> <span class="s2">&quot;2017&quot;</span><span class="p">,</span> <span class="s2">&quot;2018&quot;</span><span class="p">,</span> <span class="s2">&quot;2019&quot;</span><span class="p">],</span> <span class="n">var_name</span> <span class="o">=</span> <span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;Capacity&#39;</span><span class="p">,)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">sea</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Year</th>
      <th>Capacity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Cambodia</td>
      <td>2015</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Indonesia</td>
      <td>2015</td>
      <td>0.7</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Malaysia</td>
      <td>2015</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Phillippines</td>
      <td>2015</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Thailand</td>
      <td>2015</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Below, we will spin up a stacked bar chart in Altair depicting the construction of new coal power generators in the South East Asian countries of Cambodia, Indonesia, Malaysia, Phillippines, Thailand, and Vietnam by year between 2015 and the first half of 2019.</p>
<p>To make things neater, it's probably a good idea to remove the grid as well as unnecessary broders around the chart. Aditionally, the choice of colors for each country in the original chart is both confusing and unattractive, so we will change that up a little.</p>
<p>Next, we're going to rescale the X-axis to the range of 0-15 so as to accurately depict the data, as well as simplify the X ticks in order to further reduce the clutter.</p>
<p>The legend seems a tad small in comparison to the chart so that's going to need some tweaking as well.</p>
<p>Finally, using tooltip, we'll add an interactive element to the chart wherein, simply by hovering your mouse pointer over an area of any bar, you will be able to see the corresponding country and its projected additional coal power generation capacity for that year.</p>
<div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">sea</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;New Coal Generator (in Megawatts) Construction in South East Asia By Year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">title</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">labelAngle</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;Capacity&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">title</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">]),</span><span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">])),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="n">orient</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">)),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="s2">&quot;Capacity&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">configure_axis</span><span class="p">(</span>
    <span class="n">grid</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span><span class="o">.</span><span class="n">configure_view</span><span class="p">(</span><span class="n">strokeOpacity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">configure_legend</span><span class="p">(</span><span class="n">clipHeight</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">labelFontSize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">titleFontSize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>


<div id="altair-viz-22"></div>

<script type="text/javascript">
  (function(spec, embedOpt){
    const outputDiv = document.getElementById("altair-viz-22");
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.0.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300, "strokeOpacity": 0}, "axis": {"grid": false}, "legend": {"clipHeight": 25, "labelFontSize": 15, "titleFontSize": 15}}, "data": {"name": "data-756e8efff7e925bd041eca43b6e8db24"}, "mark": "bar", "encoding": {"color": {"type": "nominal", "field": "Country", "legend": {"orient": "right", "title": "Country"}}, "tooltip": [{"type": "nominal", "field": "Country"}, {"type": "quantitative", "field": "Capacity"}], "x": {"type": "nominal", "axis": {"labelAngle": 0, "title": null}, "field": "Year"}, "y": {"type": "quantitative", "axis": {"title": null, "values": [0, 5, 10, 15]}, "field": "Capacity", "scale": {"domain": [0, 15]}}}, "height": 500, "title": "New Coal Generator (in Megawatts) Construction in South East Asia By Year", "width": 800, "$schema": "https://vega.github.io/schema/vega-lite/v4.0.0.json", "datasets": {"data-756e8efff7e925bd041eca43b6e8db24": [{"Country": "Cambodia", "Year": "2015", "Capacity": 0.0}, {"Country": "Indonesia", "Year": "2015", "Capacity": 0.7}, {"Country": "Malaysia", "Year": "2015", "Capacity": 0.0}, {"Country": "Phillippines", "Year": "2015", "Capacity": 0.8}, {"Country": "Thailand", "Year": "2015", "Capacity": 0.0}, {"Country": "Vietnam", "Year": "2015", "Capacity": 3.6}, {"Country": "Cambodia", "Year": "2016", "Capacity": 0.0}, {"Country": "Indonesia", "Year": "2016", "Capacity": 6.2}, {"Country": "Malaysia", "Year": "2016", "Capacity": 2.0}, {"Country": "Phillippines", "Year": "2016", "Capacity": 1.0}, {"Country": "Thailand", "Year": "2016", "Capacity": 0.6}, {"Country": "Vietnam", "Year": "2016", "Capacity": 3.1}, {"Country": "Cambodia", "Year": "2017", "Capacity": 0.0}, {"Country": "Indonesia", "Year": "2017", "Capacity": 6.1}, {"Country": "Malaysia", "Year": "2017", "Capacity": 0.0}, {"Country": "Phillippines", "Year": "2017", "Capacity": 0.1}, {"Country": "Thailand", "Year": "2017", "Capacity": 0.1}, {"Country": "Vietnam", "Year": "2017", "Capacity": 0.0}, {"Country": "Cambodia", "Year": "2018", "Capacity": 0.1}, {"Country": "Indonesia", "Year": "2018", "Capacity": 1.1}, {"Country": "Malaysia", "Year": "2018", "Capacity": 0.0}, {"Country": "Phillippines", "Year": "2018", "Capacity": 0.0}, {"Country": "Thailand", "Year": "2018", "Capacity": 0.0}, {"Country": "Vietnam", "Year": "2018", "Capacity": 1.5}, {"Country": "Cambodia", "Year": "2019", "Capacity": 0.0}, {"Country": "Indonesia", "Year": "2019", "Capacity": 1.5}, {"Country": "Malaysia", "Year": "2019", "Capacity": 0.0}, {"Country": "Phillippines", "Year": "2019", "Capacity": 0.0}, {"Country": "Thailand", "Year": "2019", "Capacity": 0.0}, {"Country": "Vietnam", "Year": "2019", "Capacity": 0.0}]}}, {"mode": "vega-lite"});
</script>
 </div>
</div>
 </div>
</body>
</html>